<script src="../views/sorttable.js"></script>

<style>
  #games { font-family: Arial; border-collapse: collapse; font-size: 8pt; }
  #games td, #games th { border: 1px solid #ddd; padding: 8px; }
  #games tr:nth-child(even) { background-color: #f2f2f2; }
  #games tr:hover * { background-color: rgb(194, 149, 141) !important; }
  #games th { background-color: #4CAF50; color: white; }
  #games td { white-space: nowrap; }
  .number { text-align: right; }
  .low { background-color: silver; }
  .high { background-color: rgb(183, 214 ,170); }
  .right-border { border-right: 1px solid #999 !important; }
  .player-rank-1 { background-color: #ccccff; } /* blue */
  .player-rank-2 { background-color: #ccccff; } /* blue */
  .player-rank-3 { background-color: #ccccff; } /* blue */
  .player-rank-4 { background-color: #ccffcc; } /* green */
  .player-rank-5 { background-color: #ffd27f; } /* orange */
  .player-rank-6 { background-color: #ffb2b2; } /* red */
</style>

<table id="games" class="sortable">
  <tr>
    <th>Subdomain</th>
    <th>Game</th>
    <th>Year</th>
    <th>Player Count</th>
    <th>Rank</th>
    <th>Rating</th>
    <th>Voters</th>
    <th>Location</th>
    <th>Shelf</th>
    <th>Category</th>
    <th>Date Added</th>
    <th>Rules</th>
    <th>Difficulty</th>
    <% @months.each do |month| %>
      <th class="rank"><div><span><%= month.strftime("%m/%y") %></span></div></th>
    <% end %>
  </tr>
  <% @games.each do |game| %>
    <%
      low_rank = game[:rank].to_i > 300
      low_players = game[:player_count].to_i < 300
      low_rating = game[:rating].to_f < 7.5
      low_voters = game[:voters].to_i < 3000
      low_game = low_players || low_rating || low_voters
    %>
    <tr>
      <td><%= game[:subdomains].to_a.join(" ").titlecase %></td>
      <td class="<%= "low" if low_game %>"><a href="https://boardgamegeek.com<%= game[:href] %>"><%= game[:name] %></a></td>
      <td class="number"><%= game[:year] %></td>
      <td class="number <%= "low" if low_players %>"><%= game[:player_count] %></td>
      <td class="number <%= "low" if low_rank %>"><%= game[:rank] %></td>
      <td class="number <%= "low" if low_rating %>"><%= game[:rating] %></td>
      <td class="number <%= "low" if low_voters %>"><%= game[:voters] %></td>
      <td><%= game[:location] %></td>
      <td><%= game[:shelf] %></td>
      <td><%= game[:category] %></td>
      <td><%= game[:ts_added] %></td>
      <td>
        <% if game[:rules_url].present? %>
          <a href="<%= game[:rules_url] %>">Rules</a>
        <% end %>
      </td>
      <td class="number right-border"><%= game[:difficulty] %></td>
      <% @months.each do |month| %>
        <%
          player_count = game[:players].to_h[month.to_s].to_i
          player_count_rank = player_count.zero? ? 0 : (Math.log(player_count) / Math.log(@max_player_count) * 6).ceil
        %>
        <td class="number player-rank-<%= player_count_rank %>"><%= game[:players].to_h[month.to_s] %></td>
      <% end %>
    </tr>
  <% end %>
</table>
