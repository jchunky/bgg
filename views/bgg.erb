<link href="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/sortable.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/sortable.min.js"></script>

<style>
  #games { font-family: Arial; border-collapse: collapse; font-size: 8pt; margin-top: 20px; }
  #games td, #games th { border: 1px solid #ddd; padding: 8px; }
  #games tr:nth-child(even) { background-color: #f2f2f2; }
  #games tbody tr:hover * { background-color: rgb(194, 149, 141) !important; }
  #games th { background-color: #4CAF50; color: white; }
  #games td { white-space: nowrap; }
  .number { text-align: right; }
  .bad { background-color: silver; }
  th { position: sticky; top: 20; }
</style>

<table id="games" class="sortable">
  <thead>
    <tr>
      <th>Year</th>
      <th>Plays</th>
      <th>Play Rank</th>
      <th>Game</th>
      <th>Votes</th>
      <th>Votes Rank</th>
      <th>Rank</th>
      <th>Rating</th>
      <th>Weight</th>
      <th>Replays</th>
      <th>Player Count</th>
      <th>Max Playing Time</th>
      <th>Min Age</th>
      <th>Category</th>
      <th>Mechanism</th>
      <th>Family</th>
      <th>Type</th>
      <th>Own</th>
    </tr>
  </thead>
  <tbody>
    <% @games.each.with_index do |game, i| %>
      <%
        bad_rank = !game.rank.between?(1, 100)
        bad_plays = bad_plays_rank = !game.play_rank.between?(1, 100)
        bad_votes = bad_votes_rank = !game.vote_rank.between?(1, 100)
        bad_rating = !game.rating.in?(@rating_upper_bound..)
        bad_replays = !game.replays.in?(@replays_upper_bound..)
        bad_weight = !game.weight.in?(@weight_lower_bound...@weight_upper_bound)
        bad_year = !game.year.in?(@year_lower_bound...@year_upper_bound)
        bad_game = bad_plays_rank
      %>
      <tr>
        <td class="number <%= 'bad' if bad_year %>"><%= game.year %></td>
        <td class="number <%= 'bad' if bad_plays %>"><%= game.unique_users %></td>
        <td class="number <%= 'bad' if bad_plays_rank %>"><%= game.play_rank %></td>
        <td class="<%= 'bad' if bad_game %>"><a href="https://boardgamegeek.com<%= game.href %>"><%= game.name %></a></td>
        <td class="number <%= 'bad' if bad_votes %>"><%= game.rating_count %></td>
        <td class="number <%= 'bad' if bad_votes_rank %>"><%= game.vote_rank %></td>
        <td class="number <%= 'bad' if bad_rank %>"><%= game.rank %></td>
        <td class="number <%= 'bad' if bad_rating %>"><%= format("%0.2f", game.rating) %></td>
        <td class="number <%= 'bad' if bad_weight %>"><%= format("%0.2f", game.weight) %></td>
        <td class="number <%= 'bad' if bad_replays %>"><%= game.replays %></td>
        <td class="number"><%= game.player_count %></td>
        <td><%= game.max_playtime_label %></td>
        <td class="number"><%= game.min_age %></td>
        <td><%= game.categories %></td>
        <td><%= game.mechanics %></td>
        <td><%= game.families %></td>
        <td><%= game.subdomains %></td>
        <td><%= "own" if game.own? %></td>
      </tr>
    <% end %>
  </tbody>
</table>
