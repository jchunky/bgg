<head>
  <style>
    body { width: 60%; }
    .dataTable { font-family: sans-serif; border-collapse: collapse; font-size: 8pt; margin-top: 20px; }
    .dataTable tr:nth-child(even) { background-color: #f2f2f2; }
    .dataTable tbody tr:hover * { background-color: rgb(194, 149, 141) !important; }
    .dataTable th { background-color: #4CAF50; color: white; }
    .dataTable td { white-space: nowrap; }
    .number { text-align: right; }
    .bad { background-color: silver; }
  </style>
  <link href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/4.0.1/js/dataTables.fixedHeader.min.js"></script>
  <script>
    $(function() {
      $('#games').DataTable({
        fixedHeader: true,
        order: [[0, 'desc'], [2, 'asc']],
        paging: false
      });
    });
  </script>
</head>
<body>
  <table id="games">
    <thead>
      <tr>
        <th>Year</th>
        <th>Plays</th>
        <th>Play Rank</th>
        <th>Game</th>
        <th>Votes</th>
        <th>Votes Rank</th>
        <th>Rank</th>
        <th>Rating</th>
        <th>Weight</th>
        <th>Replays</th>
        <th>GHI</th>
        <th>Price</th>
        <th>GHI / Price</th>
        <th>Player Count</th>
        <th>Playtime</th>
        <th>Offer Count</th>
        <th>Subdomain</th>
        <th>Corridor Rank</th>
        <th>Couples Rank</th>
        <th>Solo Rank</th>
        <th>Category</th>
      </tr>
    </thead>
    <tbody>
      <% @games.each do |game| %>
        <%
          bad_conditions = {
            bad_offer_count: !(10..).cover?(game.offer_count),
            bad_player_count: !(1..2).cover?(game.min_player_count),
            bad_plays: !(1..700).cover?(game.play_rank),
            bad_plays_rank: !(1..700).cover?(game.play_rank),
            bad_playtime: !(1..60).cover?(game.playtime),
            bad_rank: !(1..2000).cover?(game.rank),
            bad_rating: !(7..).cover?(game.rating),
            bad_replays: !(10..).cover?(game.replays),
            bad_ghi: !(30..).cover?(game.ghi),
            bad_price: !(1..30).cover?(game.price),
            bad_ghi_per_price: !(1..).cover?(game.ghi_per_price),
            bad_votes: !(1..2000).cover?(game.vote_rank),
            bad_votes_rank: !(1..2000).cover?(game.vote_rank),
            bad_weight: !(1..2.5).cover?(game.weight),
            bad_year: !(2010..Time.now.year - 2).cover?(game.year),
          }
          bad_game =
            bad_conditions[:bad_rank] ||
            bad_conditions[:bad_ghi] ||
            bad_conditions[:bad_ghi_per_price]
        %>
        <tr>
          <td class="number <%= 'bad' if bad_conditions[:bad_year] %>"><%= int(game.year) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_plays] %>"><%= int(game.unique_users) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_plays_rank] %>"><%= int(game.play_rank) %></td>
          <td class="<%= 'bad' if bad_game %>"><a href="https://boardgamegeek.com<%= game.href %>"><%= game.name %></a></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_votes] %>"><%= int(game.rating_count) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_votes_rank] %>"><%= int(game.vote_rank) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_rank] %>"><%= int(game.rank) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_rating] %>"><%= float(game.rating, decimals: 1) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_weight] %>"><%= float(game.weight, decimals: 1) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_replays] %>"><%= int(game.replays) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_ghi] %>"><%= int(game.ghi) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_price] %>"><%= float(game.price, decimals: 0) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_ghi_per_price] %>"><%= float(game.ghi_per_price, decimals: 2) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_player_count] %>"><%= int(game.player_count) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_playtime] %>"><%= int(game.playtime) %></td>
          <td class="number <%= 'bad' if bad_conditions[:bad_offer_count] %>"><%= int(game.offer_count) %></td>
          <td><%= game.subdomains %></td>
          <td class="number"><%= int(game.corridor_rank) %></td>
          <td class="number"><%= int(game.couples_rank) %></td>
          <td class="number"><%= int(game.solo_rank) %></td>
          <td><%= game.category_label %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</body>
